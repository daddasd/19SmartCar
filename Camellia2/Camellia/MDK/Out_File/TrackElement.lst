C251 COMPILER V5.60.0,  TrackElement                                                       16/05/24  20:27:42  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE TrackElement
OBJECT MODULE PLACED IN .\Out_File\TrackElement.obj
COMPILER INVOKED BY: F:\Keil_c251\C251\BIN\C251.EXE ..\USER\Hardware\TrackElement.c XSMALL WARNINGLEVEL(3) OPTIMIZE(0,SP
                    -EED) BROWSE INCDIR(..\..\Libraries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_peripheral;..\C
                    -ODE;..\USER\inc;..\USER\src;..\USER\Hardware;..\USER\Hardware) DEBUG PRINT(.\Out_File\TrackElement.lst) TABS(2) OBJECT(.
                    -\Out_File\TrackElement.obj) 

stmt  level    source

    1          /*
    2           * @Description: 
    3           * @Author: Yzhi
    4           * @Date: 2024-01-10 09:24:18
    5           * @LastEditTime: 2024-01-10 09:32:32
    6           * @LastEditors: Yzhi
    7           */
    8          #include "myconfig.h"
    9          
   10          int Element_Order[4]={0};
   11          
   12          int shizi_flag=0;
   13          int ring_flag=-1;
   14          long bmq_jifen=0;
   15          double angle_jifen=0;
   16          int Track_flag=0; //æ­£å¸¸å¾ªè¿¹
   17          int set_speed = 0; //åœ¨èµ›é“ä¸Šä¸æ–­æ›´æ”¹é€Ÿåº¦
   18          int L_Out = 0;
   19          int R_Out = 0;
   20          
   21          int RING_FLAG1=0;
   22          int RING_FLAG2=0;
   23          int RING_FLAG3=0;
   24          int RING_FLAG4=0;
   25          
   26          int ANGLE_FLAG=0; //è§’åº¦ç§¯åˆ†æ ‡å¿—
   27          double Angle4=0;  //è§’åº¦ç§¯åˆ†
   28          int DISTANCE_FLAG=0;//è·ç¦»ç§¯åˆ†æ ‡å¿—
   29          long Distance=0;//è·ç¦»ç§¯åˆ†
   30          
   31          int RAngle_Flag = 0; //90åº¦æ ‡å¿—ä½
   32          
   33          /*å¤–ç¯ä¸ç”µæœºpidä¸é€Ÿåº¦æ”¹å˜çš„å‚æ•°*/
   34          
   35          double Sub_wh_p = 20;
   36          double Sub_wh_d = 10;
   37          double Sub_motor_p = 0;
   38          double Sub_motor_i = 0;
   39          int    Sub_speed = -10;
   40          /*è§’åº¦ç¯å‚æ•°*/
   41          float Angle_P = 70;
   42          float Angle_I = 0.4;
   43          float Angle_D = 40;
   44          
   45          /*ä¸åŒå…ƒç´ é€Ÿåº¦æ§åˆ¶*/
   46          int Speed_Plan1 = 0;
   47          
   48          int Err_speed = 0;
   49          
   50          void Distace(int flag)
   51          {
   52   1        DISTANCE_FLAG=flag;
   53   1        if(DISTANCE_FLAG)
   54   1           Distance+=(R_Pulse+L_Pulse)/2;
   55   1      }
   56          
C251 COMPILER V5.60.0,  TrackElement                                                       16/05/24  20:27:42  PAGE 2   

   57          /**
   58          *  @brief      åå­—è·¯å£
   59          *  @param      void
   60          *  @return     void
   61          **/
   62          void Crossroad(void)
   63          {
   64   1         if(L1_NOR_ADC>40&&L2_NOR_ADC>40&&R2_NOR_ADC>40&&R1_NOR_ADC>40||shizi_flag==-1)//åå­—è·¯å£
   65   1         {
   66   2          shizi_flag=-1;
   67   2          Track_flag=0;
   68   2          bmq_jifen+=(R_Pulse+L_Pulse)/2;
   69   2          if(bmq_jifen>524)
   70   2          {
   71   3            bmq_jifen=0;
   72   3            shizi_flag=1;
   73   3          }
   74   2          Motor_PWM(2000,2000);
   75   2         }
   76   1         else
   77   1           Track_flag=1;//æ­£å¸¸å¾ªè¿¹
   78   1      }
   79          
   80          
   81          /**
   82          *  @brief      å…­è¾¹ç¯å²›
   83          *  @param      è§’åº¦
   84          *  @return     void       
   85          **/
   86          //void Roundabout(float angle)
   87          //{
   88          //   static int bmq_flag=0,angle_flag=0,angle2=0,yu_flag=0,angle_flag2=0,status=0;
   89          //   if(L1_NOR_ADC>100&&R1_NOR_ADC>55&&R2_NOR_ADC<15&&L2_NOR_ADC<15||ring_flag==0||ring_flag==1)//å…­è¾¹ç
             -¯å²›
   90          //   {
   91          //     if(status==0)  //é¢„è¿›å…¥ç¯å²›
   92          //      if(bmq_jifen<4524&&bmq_flag==0)
   93          //      {
   94          //        bmq_jifen+=(R_Pulse+L_Pulse)/2;
   95          //        Motor_PWM(2000,2000);
   96          //        ring_flag=0;
   97          //        Track_flag=0;
   98          //      }
   99          //      else
  100          //      {
  101          //        status=1; 
  102          //        bmq_jifen=0;
  103          //        bmq_flag=1; //ç¼–ç å™¨åœæ­¢ç§¯åˆ†
  104          //        angle_flag2=2;//è¿›å…¥ç¯å²›æ‰“å›ºå®šè§’åº¦
  105          //      }
  106          //    else if(status==1)//è¿›å…¥ç¯å²›
  107          //    { 
  108          //      if(angle_flag2==2&&angle_flag==0)//è½¬40åº¦
  109          //      {
  110          //        if (Angle_Ring(45, angle1, Angle_P, Angle_I, Angle_D))
  111          //        {
  112          //          angle1=0;  //è§’åº¦ç§¯åˆ†æ¸…é›¶
  113          //          yu_flag=3;//ç¼–ç å™¨å¼€å¯ç§¯åˆ†
  114          //          angle_flag2=0;//é€€å‡ºè§’åº¦ç§¯åˆ†
  115          //          angle_flag=1;//åœæ­¢é™€èºä»ªç§¯åˆ†
  116          //        }
  117          //        else
  118          //            angle1+=(Get_Angle()/7387)+0.0001;
  119          //      }
  120          //      if(yu_flag==3) //è¿›å…¥åœ†ç¯è¡Œé©¶ä¸€æ®µè·ç¦»å¼€å§‹æ­£å¸¸å¾ªè¿¹
  121          //      {
C251 COMPILER V5.60.0,  TrackElement                                                       16/05/24  20:27:42  PAGE 3   

  122          //        if(bmq_jifen<1024&&yu_flag==3)
  123          //        {
  124          //          bmq_jifen+=(R_Pulse+L_Pulse)/2;
  125          //          Motor_PWM(2000,2000);
  126          //        }
  127          //        else
  128          //        {
  129          //          bmq_jifen=0;
  130          //          yu_flag=0; //ç¼–ç å™¨åœæ­¢ç§¯åˆ†
  131          //          ring_flag=4;//è¿›å…¥åœ†ç¯ç»“æŸ
  132          //          status=3;
  133          //          Track_flag=1;//æ­£å¸¸å¾ªè¿¹
  134          //        }     
  135          //      }
  136          //    }
  137          //    else if(status==3) //å‡ºç¯å²›
  138          //    {
  139          //      if(R1_NOR_ADC>30&&L1_NOR_ADC>30&&R2_NOR_ADC<10&&L2_NOR_ADC>15||status==3)//å‡ºå…­è¾¹ç¯å²›
  140          //      {
  141          //        if(bmq_jifen<1524&&status==3)
  142          //        {
  143          //          bmq_jifen+=(R_Pulse+L_Pulse)/2;
  144          //          Motor_PWM(1800,2300);
  145          //        }
  146          //        else
  147          //        {
  148          //          bmq_jifen=0;
  149          //          status=4;
  150          //          Track_flag=1;//æ­£å¸¸å¾ªè¿¹
  151          //        }   
  152          //      }
  153          //    }
  154          //    else
  155          //       Track_flag=1;
  156          //   }
  157          //   else 
  158          //     Track_flag=1;
  159          //}
  160          /**
  161           * @brief æ ¹æ®æ ‡å¿—ä½ç»™ä¸åŒé€Ÿåº¦
  162           * 
  163           * @param speed_flag 
  164           */
  165          void Speed_Plan(int speed_flag)
  166          {
  167   1        switch (speed_flag)
  168   1        {
  169   2        case 1:
  170   2          Speed_Plan1 = 0;  //æ­£å¸¸å¾ªè¿¹é€Ÿåº¦
  171   2          break;
  172   2        case 2:
  173   2          Speed_Plan1 = -speed; //ç›´è§’åé€Ÿåº¦æ¸…é›¶
  174   2          break;
  175   2        case 3:
  176   2          Speed_Plan1 = -speed*0.30; // ç¯å²›å†…é€Ÿåº¦ï¼Œä¸ºæ­£å¸¸é€Ÿåº¦çš„ç™¾åˆ†ä¹‹70
  177   2          break;
  178   2        case 4:
  179   2          Speed_Plan1 = -speed * 0.5; // é¢„è¿›åœ†ç¯ï¼Œä¸ºæ­£å¸¸é€Ÿåº¦çš„ç™¾åˆ†ä¹‹50;
  180   2          break;
  181   2        case 5:
  182   2          Speed_Plan1 = speed * 0.4; // ç›´é“åŠ é€Ÿ ï¼Œå¤§äºæ­£å¸¸é€Ÿåº¦çš„ç™¾åˆ†ä¹‹40;
  183   2          break;
  184   2        default:
  185   2          break;
  186   2        }
  187   1      }
C251 COMPILER V5.60.0,  TrackElement                                                       16/05/24  20:27:42  PAGE 4   

  188          
  189          void Sub_Pid(float error)
  190          {
  191   1          float err = error;
  192   1        if(err>20) //åç¦»èµ›é“æœ€å¤§
  193   1        {
  194   2          Sub_wh_p = 20;
  195   2          Sub_wh_d = 10;
  196   2          Sub_motor_p = 0;
  197   2          Sub_motor_i = 0;
  198   2          Sub_speed = -10;
  199   2        }
  200   1      }
  201          
  202          /**
  203          *  @brief      åŸºç¡€å¾ªè¿¹
  204          *  @param      void
  205          *  @return     void        
  206          **/
  207          void Tracking(int Set_speed)
  208          {
  209   1        static int count=0,Lpwm=0,Rpwm=0,pwm=0;
  210   1        Sum_Pulse=(L_Pulse+R_Pulse)/2;
  211   1        count++;
  212   1        dir_out=DirControl();
  213   1        if(count==10)
  214   1        {
  215   2          pwm=Speed_pid_Out(Set_speed, Sum_Pulse);
  216   2          count=0;
  217   2        }
  218   1        Motor_PWM(pwm - dir_out, pwm + dir_out);
  219   1        //Motor_PWM(Lpwm,Rpwm);
  220   1      }
  221          /**
  222           * @brief æ ¹æ®ä¸åŒé€Ÿåº¦ç»™æ ‡å¿—ä½
  223           * 
  224           */
  225          void Error_Speed(void)
  226          {
  227   1        if(Inductance_Error<40)
  228   1          Err_speed = speed * 0.10; //æç™¾åˆ†ä¹‹30çš„é€Ÿåº¦
  229   1        else if(Inductance_Error >=40 && Inductance_Error <=55)
  230   1          Err_speed = speed * 0.15 ;//æç™¾åˆ†ä¹‹20çš„é€Ÿåº¦
  231   1        else if(Inductance_Error > 55 && Inductance_Error <=65)
  232   1          Err_speed = -speed * 0.65;//é™ä½ç™¾åˆ†ä¹‹45çš„é€Ÿåº¦
  233   1        else if(Inductance_Error > 65 && Inductance_Error <=75)
  234   1          Err_speed = -speed * 0.75;//é™ä½ç™¾åˆ†ä¹‹55çš„é€Ÿåº¦
  235   1        else if(Inductance_Error >75)
  236   1          Err_speed = -speed * 0.77;//é™ä½ç™¾åˆ†ä¹‹ç™¾çš„é€Ÿåº¦
  237   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       768     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =       106     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
C251 COMPILER V5.60.0,  TrackElement                                                       16/05/24  20:27:42  PAGE 5   

  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =       220     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
