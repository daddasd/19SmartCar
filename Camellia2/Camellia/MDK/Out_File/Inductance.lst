C251 COMPILER V5.60.0,  Inductance                                                         16/05/24  14:37:27  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE Inductance
OBJECT MODULE PLACED IN .\Out_File\Inductance.obj
COMPILER INVOKED BY: E:\Keil5C251\C251\BIN\C251.EXE ..\USER\Hardware\Inductance.c XSMALL WARNINGLEVEL(3) OPTIMIZE(0,SPEE
                    -D) BROWSE INCDIR(..\..\Libraries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_peripheral;..\COD
                    -E;..\USER\inc;..\USER\src;..\USER\Hardware;..\USER\Hardware) DEBUG PRINT(.\Out_File\Inductance.lst) TABS(2) OBJECT(.\Out
                    -_File\Inductance.obj) 

stmt  level    source

    1          /*
    2           * @Description: 
    3           * @Author: Yzhi
    4           * @Date: 2023-11-17 20:11:13
    5           * @LastEditTime: 2023-11-28 17:34:59
    6           * @LastEditors: Yzhi
    7           */
    8          #include "myconfig.h"
    9          
   10          
   11          #define filter_n 9//æ•°ç»„é•¿åº¦
   12          
   13          
   14          uint16 Left_Val=0,Right_Val=0;
   15          int16 ad_sum=0;
   16          int16 ad_diff=0;
   17          uint16 ad_value[7][10]={0};//åŸå§‹æ•°æ®
   18          uint16 R1,R2,R3,L1,L2,L3,M1;//æ»¤æ³¢ä¹‹åçš„ç”µæ„Ÿå€¼
   19          uint16 L1_NOR_ADC=0,R1_NOR_ADC=0,L2_NOR_ADC=0,R2_NOR_ADC=0,L3_NOR_ADC=0,R3_NOR_ADC=0,M1_NOR_ADC=0;
   20          float NOR_VAL[7]={0};
   21          float AD_NOR_VAL[7]={0}; //å½’ä¸€åŒ–å€¼
   22          int16 Inductance_Error=0; //ç”µæ„Ÿè¯¯å·®
   23          uint16 ADC_MIN[7]={156,252,160,150,153,180,149};
   24          uint16 ADC_MAX[7]={3020,2620,2620,2620,2600,2600,2600}; //æµ‹å‡ºçš„ç”µæ„Ÿæœ€å¤§ï¼Œä¸æœ€å°å€¼ä»å·¦åˆ°å
             -³
   25          int bug=0;
   26          /**
   27          *  @brief      ADCé‡‡é›†åˆå§‹åŒ–
   28          *  @param      void
   29          *  @return     void         
   30          **/
   31          
   32          void Inductance_Init(void)
   33          {
   34   1        adc_init(ADC_P10, ADC_SYSclk_DIV_2);
   35   1        adc_init(ADC_P05, ADC_SYSclk_DIV_2);
   36   1        adc_init(ADC_P06, ADC_SYSclk_DIV_2);        
   37   1          adc_init(ADC_P00, ADC_SYSclk_DIV_2);    
   38   1        adc_init(ADC_P01, ADC_SYSclk_DIV_2);
   39   1        adc_init(ADC_P02, ADC_SYSclk_DIV_2);
   40   1          adc_init(ADC_P03, ADC_SYSclk_DIV_2);
   41   1        adc_init(ADC_P04, ADC_SYSclk_DIV_2);
   42   1      }
   43          /**
   44           * @brief å¿«é€Ÿå¼€æ–¹
   45           * 
   46           * @param f è¢«å¼€æ–¹æ•°
   47           * @return float 
   48           */
   49          float sq(float number)
   50          {  
   51   1        long i;
   52   1        float x, y;
   53   1        const float f = 1.5F;
   54   1        
   55   1        x = number * 0.5F;
C251 COMPILER V5.60.0,  Inductance                                                         16/05/24  14:37:27  PAGE 2   

   56   1        y = number;
   57   1        i = * ( long * ) &y;
   58   1        i = 0x5f3759df - ( i >> 1 );
   59   1        y = * ( float * ) &i;
   60   1        y = y * ( f - ( x * y * y ) );
   61   1        y = y * ( f - ( x * y * y ) );
   62   1        return number * y;
   63   1      }
   64          
   65          
   66          
   67          /**
   68          *  @brief      å½’ä¸€åŒ–å¤„ç†ç”µæ„Ÿå€¼å¹¶å¾ªè¿¹æ§åˆ¶
   69          *  @param      I1,I2,åŠ æƒç³»æ•°,
   70          *  @return     void         
   71          **/
   72          int16 NORMALIZATION_TRACKING_ADC(float I1,float I2)  
   73          {
   74   1        int i = 0, j = 0, k = 0, temp = 0;
   75   1        int ad_sum1[7] = {0};
   76   1        uint16 ad_valu1[7] = {0};
   77   1        for (i = 0; i < 10; i++) // è¯»å–åæ¬¡ç”µæ„Ÿ
   78   1        {
   79   2            ad_value[0][i] = adc_once(ADC_P10, ADC_12BIT);
   80   2            ad_value[1][i] = adc_once(ADC_P05, ADC_12BIT);
   81   2            ad_value[2][i] = adc_once(ADC_P06, ADC_12BIT);
   82   2            ad_value[3][i] = adc_once(ADC_P00, ADC_12BIT);
   83   2            ad_value[4][i] = adc_once(ADC_P01, ADC_12BIT);
   84   2            ad_value[5][i] = adc_once(ADC_P02, ADC_12BIT);
   85   2              ad_value[6][i] = adc_once(ADC_P03, ADC_12BIT);
   86   2            bug=       adc_once(ADC_P04, ADC_12BIT);
   87   2        }
   88   1      
   89   1        /*=========================å†’æ³¡æ’åºå‡åº==========================*/
   90   1        for (i = 0; i < 7; i++)
   91   1        {
   92   2            for (j = 0; j < 10 - 1; j++)
   93   2            {
   94   3                for (k = 0; k < 10 - 1 - j; k++)
   95   3                {
   96   4                    if (ad_value[i][k] > ad_value[i][k + 1]) // å‰é¢çš„æ¯”åé¢çš„å¤§ï¼Œåˆ™è¿›è¡Œäº¤æ¢
   97   4                    {
   98   5                        temp = ad_value[i][k + 1];
   99   5                        ad_value[i][k + 1] = ad_value[i][k];
  100   5                        ad_value[i][k] = temp;
  101   5                    }
  102   4                }
  103   3            }
  104   2        }
  105   1      
  106   1        /*===========================ä¸­å€¼æ»¤æ³¢=================================*/
  107   1        for (i = 0; i < 7; i++) // æ±‚ä¸­é—´å…«é¡¹çš„å’Œ
  108   1        {
  109   2            for (k = 0; k < 9; k++) // èˆå¼ƒæœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œåªå–ä¸­é—´8é¡¹
  110   2            {
  111   3                ad_sum1[i] += ad_value[i][k];
  112   3            }
  113   2            ad_valu1[i] = ad_sum1[i] / 8;
  114   2        }
  115   1      
  116   1        /*=========================èµ‹å€¼å„ä¸ªç”µæ„Ÿ==============================*/
  117   1        L1 = ad_valu1[0];
  118   1        L2 = ad_valu1[1];
  119   1        L3 = ad_valu1[2];
  120   1        M1 = ad_valu1[3];
  121   1        R3 = ad_valu1[4];
C251 COMPILER V5.60.0,  Inductance                                                         16/05/24  14:37:27  PAGE 3   

  122   1        R2 = ad_valu1[5];
  123   1        R1 = ad_valu1[6];
  124   1        
  125   1      
  126   1        
  127   1        
  128   1      
  129   1        NOR_VAL[0]=(float)(L1-ADC_MIN[0])/(float)(ADC_MAX[0]-ADC_MIN[0]);
  130   1        NOR_VAL[1]=(float)(L2-ADC_MIN[1])/(float)(ADC_MAX[1]-ADC_MIN[1]);
  131   1        NOR_VAL[2]=(float)(L3-ADC_MIN[2])/(float)(ADC_MAX[2]-ADC_MIN[2]);
  132   1        NOR_VAL[3]=(float)(M1-ADC_MIN[3])/(float)(ADC_MAX[3]-ADC_MIN[3]);
  133   1        NOR_VAL[4]=(float)(R3-ADC_MIN[4])/(float)(ADC_MAX[4]-ADC_MIN[4]);
  134   1        NOR_VAL[5]=(float)(R2-ADC_MIN[5])/(float)(ADC_MAX[5]-ADC_MIN[5]);
  135   1        NOR_VAL[6]=(float)(R1-ADC_MIN[6])/(float)(ADC_MAX[6]-ADC_MIN[6]);
  136   1        
  137   1        for(i = 0 ; i<7;i++)
  138   1        {
  139   2          if(NOR_VAL[i]<=0.0)
  140   2          {
  141   3            NOR_VAL[i]=0.001;
  142   3          }
  143   2          if(NOR_VAL[i]>1.0)
  144   2          {
  145   3            NOR_VAL[i]=1.0;
  146   3          }   
  147   2          AD_NOR_VAL[i]=NOR_VAL[i]*100;
  148   2        }
  149   1        
  150   1        
  151   1        L1_NOR_ADC=AD_NOR_VAL[0];
  152   1        L2_NOR_ADC=AD_NOR_VAL[1];
  153   1        L3_NOR_ADC=AD_NOR_VAL[2];
  154   1        M1_NOR_ADC=AD_NOR_VAL[3];
  155   1        R3_NOR_ADC=AD_NOR_VAL[4];
  156   1        R2_NOR_ADC=AD_NOR_VAL[5];
  157   1        R1_NOR_ADC=AD_NOR_VAL[6];
  158   1        
  159   1        L1_NOR_ADC=L1_NOR_ADC;
*** WARNING C138 IN LINE 159 OF ..\USER\Hardware\Inductance.c: expression with possibly no effect
  160   1        R1_NOR_ADC=I1*R1_NOR_ADC; 
  161   1        L2_NOR_ADC=L2_NOR_ADC;
*** WARNING C138 IN LINE 161 OF ..\USER\Hardware\Inductance.c: expression with possibly no effect
  162   1        R2_NOR_ADC=R2_NOR_ADC;
*** WARNING C138 IN LINE 162 OF ..\USER\Hardware\Inductance.c: expression with possibly no effect
  163   1      
  164   1        Left_Val=sq(L1_NOR_ADC*L1_NOR_ADC+L2_NOR_ADC*L2_NOR_ADC);
  165   1        Right_Val=sq(R1_NOR_ADC*R1_NOR_ADC+R2_NOR_ADC*R2_NOR_ADC);
  166   1        ad_sum=Left_Val+Right_Val;
  167   1        ad_diff=Left_Val-Right_Val;
  168   1        if(ad_sum>35)
  169   1        {
  170   2          Inductance_Error=(ad_diff <<7)/(ad_sum+1);
  171   2        }
  172   1        //Inductance_Error=ad_diff;
  173   1        return Inductance_Error; //æ”¾å¤§128å€
  174   1      }
*** WARNING C47 IN LINE 72 OF ..\USER\Hardware\Inductance.c: 'I2': unreferenced parameter
  175          
  176          /**
  177          *  @brief      æ˜¾ç¤ºæµ‹é‡å€¼
  178          *  @param      void
  179          *  @return     void         
  180          **/
  181          
  182          void show_val(void)
  183          {
C251 COMPILER V5.60.0,  Inductance                                                         16/05/24  14:37:27  PAGE 4   

  184   1      //-----------------oledæ˜¾ç¤ºç”µæ„Ÿå€¼----------------------//
  185   1        oled_p6x8str(0,0,"L1:");
  186   1        oled_uint16(15,0,L1_NOR_ADC);
  187   1      
  188   1        oled_p6x8str(70,0,"R1:");
  189   1        oled_uint16(85,0,R1_NOR_ADC);
  190   1      
  191   1        oled_p6x8str(0,1,"L2:");
  192   1        oled_uint16(15,1,L2_NOR_ADC);
  193   1      
  194   1        oled_p6x8str(70,1,"R2:");
  195   1        oled_uint16(85,1,R2_NOR_ADC);
  196   1      
  197   1        oled_p6x8str(0,2,"L3:");
  198   1        oled_uint16(15,2,L3_NOR_ADC);
  199   1      
  200   1        oled_p6x8str(70,2,"R3:");
  201   1        oled_uint16(85,2,R3_NOR_ADC);
  202   1      
  203   1        oled_p6x8str(0,3,"Err:");
  204   1        oled_int16(20,3,Inductance_Error);
  205   1        
  206   1        oled_p6x8str(70,3,"M1:");
  207   1        oled_uint16(85,3,M1_NOR_ADC);
  208   1      ////-----------------é™€èºä»ªè§’é€Ÿåº¦------------------------//
  209   1      
  210   1        oled_p6x8str(0,4,"gyro_z:");
  211   1        oled_printf_float(45, 4,mpu6050_gyro_z/65.6, 5, 6);
  212   1        oled_int16(0,5,L_Pulse);
  213   1        oled_int16(60,5,R_Pulse);
  214   1        oled_int16(0, 6, dir_out);
  215   1        oled_int16(60, 6, Speed_Ring);
  216   1        //-----------------TOFè·ç¦»------------------------//
  217   1        //  if(dl1a_finsh_flag)
  218   1        //  {
  219   1        //    dl1a_finsh_flag = 0;
  220   1        //    oled_int16(60,6,dl1a_distance_mm);
  221   1        //  }
  222   1      
  223   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =      2129     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =       324     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =       391     ------
End of Module Information.


C251 COMPILATION COMPLETE.  4 WARNING(S),  0 ERROR(S)
