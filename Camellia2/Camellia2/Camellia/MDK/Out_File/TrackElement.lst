C251 COMPILER V5.60.0,  TrackElement                                                       12/04/24  18:31:26  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE TrackElement
OBJECT MODULE PLACED IN .\Out_File\TrackElement.obj
COMPILER INVOKED BY: E:\Keil5C251\C251\BIN\C251.EXE ..\USER\Hardware\TrackElement.c XSMALL WARNINGLEVEL(3) OPTIMIZE(0,SP
                    -EED) BROWSE INCDIR(..\..\Libraries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_peripheral;..\C
                    -ODE;..\USER\inc;..\USER\src;..\USER\Hardware;..\USER\Hardware) DEBUG PRINT(.\Out_File\TrackElement.lst) TABS(2) OBJECT(.
                    -\Out_File\TrackElement.obj) 

stmt  level    source

    1          /*
    2           * @Description: 
    3           * @Author: Yzhi
    4           * @Date: 2024-01-10 09:24:18
    5           * @LastEditTime: 2024-01-10 09:32:32
    6           * @LastEditors: Yzhi
    7           */
    8          #include "myconfig.h"
    9          
   10          int Element_Order[4]={0};
   11          
   12          int shizi_flag=0;
   13          int ring_flag=-1;
   14          long bmq_jifen=0;
   15          double angle_jifen=0;
   16          int Track_flag=0; //正常循迹
   17          int set_speed = 0; //在赛道上不断更改速度
   18          
   19          int RING_FLAG1=0;
   20          int RING_FLAG2=0;
   21          int RING_FLAG3=0;
   22          int RING_FLAG4=0;
   23          
   24          int ANGLE_FLAG=0; //角度积分标志
   25          double Angle4=0;  //角度积分
   26          int DISTANCE_FLAG=0;//距离积分标志
   27          long Distance=0;//距离积分
   28          
   29          int RAngle_Flag = 0; //90度标志位
   30          
   31          /*外环与电机pid与速度改变的参数*/
   32          
   33          double Sub_wh_p = 20;
   34          double Sub_wh_d = 10;
   35          double Sub_motor_p = 0;
   36          double Sub_motor_i = 0;
   37          int    Sub_speed = -10;
   38          /*角度环参数*/
   39          float Angle_P = 70;
   40          float Angle_I = 0.4;
   41          float Angle_D = 40;
   42          
   43          void Distace(int flag)
   44          {
   45   1        DISTANCE_FLAG=flag;
   46   1        if(DISTANCE_FLAG)
   47   1           Distance+=(R_Pulse+L_Pulse)/2;
   48   1      }
   49          
   50          /**
   51          *  @brief      十字路口
   52          *  @param      void
   53          *  @return     void
   54          **/
   55          void Crossroad(void)
   56          {
C251 COMPILER V5.60.0,  TrackElement                                                       12/04/24  18:31:26  PAGE 2   

   57   1         if(L1_NOR_ADC>40&&L2_NOR_ADC>40&&R2_NOR_ADC>40&&R1_NOR_ADC>40||shizi_flag==-1)//十字路口
   58   1         {
   59   2          shizi_flag=-1;
   60   2          Track_flag=0;
   61   2          bmq_jifen+=(R_Pulse+L_Pulse)/2;
   62   2          if(bmq_jifen>524)
   63   2          {
   64   3            bmq_jifen=0;
   65   3            shizi_flag=1;
   66   3          }
   67   2          Motor_PWM(2000,2000);
   68   2         }
   69   1         else
   70   1           Track_flag=1;//正常循迹
   71   1      }
   72          
   73          void Right_Angle(void)
   74          {
   75   1        if (L2_NOR_ADC > 75  && L3_NOR_ADC > 65 && R3_NOR_ADC < 25 && R2_NOR_ADC < 25  ) // 左转
   76   1        {
   77   2          P13=1; //蜂鸣器
   78   2          Motor_PWM(0, 0);
   79   2          Angle_Ring(90, angle1,Angle_P, Angle_I, Angle_D);
   80   2          //RAngle_Flag = 1; //清除标志位
   81   2          
   82   2        }
   83   1        else if (R2_NOR_ADC > 75  && R3_NOR_ADC > 65 && L3_NOR_ADC < 25 && L2_NOR_ADC < 25)//右转
   84   1        {
   85   2          P13=1;
   86   2          Motor_PWM(0, 0);
   87   2          Angle_Ring(-90, angle1, Angle_P, Angle_I, Angle_D);
   88   2          //RAngle_Flag = 1; // 清除标志位
   89   2          //P13=0;
   90   2        }
   91   1        else
   92   1        {
   93   2          P13=0;
   94   2        }
   95   1      }
   96          
   97          
   98          /**
   99          *  @brief      六边环岛
  100          *  @param      角度
  101          *  @return     void       
  102          **/
  103          void Roundabout(float angle)
  104          {
  105   1         static int bmq_flag=0,angle_flag=0,angle2=0,yu_flag=0,angle_flag2=0,status=0;
  106   1         if(L1_NOR_ADC>100&&R1_NOR_ADC>55&&R2_NOR_ADC<15&&L2_NOR_ADC<15||ring_flag==0||ring_flag==1)//六边环岛
  107   1         {
  108   2           if(status==0)  //预进入环岛
  109   2            if(bmq_jifen<4524&&bmq_flag==0)
  110   2            {
  111   3              bmq_jifen+=(R_Pulse+L_Pulse)/2;
  112   3              Motor_PWM(2000,2000);
  113   3              ring_flag=0;
  114   3              Track_flag=0;
  115   3            }
  116   2            else
  117   2            {
  118   3              status=1; 
  119   3              bmq_jifen=0;
  120   3              bmq_flag=1; //编码器停止积分
  121   3              angle_flag2=2;//进入环岛打固定角度
  122   3            }
C251 COMPILER V5.60.0,  TrackElement                                                       12/04/24  18:31:26  PAGE 3   

  123   2          else if(status==1)//进入环岛
  124   2          { 
  125   3            if(angle_flag2==2&&angle_flag==0)//转40度
  126   3            {
  127   4              if (Angle_Ring(45, angle1, Angle_P, Angle_I, Angle_D))
  128   4              {
  129   5                angle1=0;  //角度积分清零
  130   5                yu_flag=3;//编码器开启积分
  131   5                angle_flag2=0;//退出角度积分
  132   5                angle_flag=1;//停止陀螺仪积分
  133   5              }
  134   4              else
  135   4                  angle1+=(Get_Angle()/7387)+0.0001;
  136   4            }
  137   3            if(yu_flag==3) //进入圆环行驶一段距离开始正常循迹
  138   3            {
  139   4              if(bmq_jifen<1024&&yu_flag==3)
  140   4              {
  141   5                bmq_jifen+=(R_Pulse+L_Pulse)/2;
  142   5                Motor_PWM(2000,2000);
  143   5              }
  144   4              else
  145   4              {
  146   5                bmq_jifen=0;
  147   5                yu_flag=0; //编码器停止积分
  148   5                ring_flag=4;//进入圆环结束
  149   5                status=3;
  150   5                Track_flag=1;//正常循迹
  151   5              }     
  152   4            }
  153   3          }
  154   2          else if(status==3) //出环岛
  155   2          {
  156   3            if(R1_NOR_ADC>30&&L1_NOR_ADC>30&&R2_NOR_ADC<10&&L2_NOR_ADC>15||status==3)//出六边环岛
  157   3            {
  158   4              if(bmq_jifen<1524&&status==3)
  159   4              {
  160   5                bmq_jifen+=(R_Pulse+L_Pulse)/2;
  161   5                Motor_PWM(1800,2300);
  162   5              }
  163   4              else
  164   4              {
  165   5                bmq_jifen=0;
  166   5                status=4;
  167   5                Track_flag=1;//正常循迹
  168   5              }   
  169   4            }
  170   3          }
  171   2          else
  172   2             Track_flag=1;
  173   2         }
  174   1         else 
  175   1           Track_flag=1;
  176   1      }
*** WARNING C47 IN LINE 103 OF ..\USER\Hardware\TrackElement.c: 'angle': unreferenced parameter
  177          
  178          void Sub_Pid(float error)
  179          {
  180   1          float err = error;
  181   1        if(err>20) //偏离赛道最大
  182   1        {
  183   2          Sub_wh_p = 20;
  184   2          Sub_wh_d = 10;
  185   2          Sub_motor_p = 0;
  186   2          Sub_motor_i = 0;
  187   2          Sub_speed = -10;
C251 COMPILER V5.60.0,  TrackElement                                                       12/04/24  18:31:26  PAGE 4   

  188   2        }
  189   1      }
  190          
  191          /**
  192          *  @brief      基础循迹
  193          *  @param      void
  194          *  @return     void        
  195          **/
  196          void Tracking(int Set_speed)
  197          {
  198   1        static int count=0,pwm=0;
  199   1        Sum_Pulse=(L_Pulse+R_Pulse)/2;
  200   1        count++;
  201   1        dir_out=DirControl();
  202   1        if(count==10)
  203   1        {
  204   2          pwm=Speed_pid_Out(Set_speed,Sum_Pulse); //减或加一个方向环的输出
  205   2          count=0;
  206   2        }
  207   1        Motor_PWM(pwm-dir_out,pwm+dir_out);
  208   1      }
  209          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =      1238     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =       104     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =       220     ------
End of Module Information.


C251 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
