C251 COMPILER V5.60.0,  TrackElement                                                       07/04/24  19:47:35  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE TrackElement
OBJECT MODULE PLACED IN .\Out_File\TrackElement.obj
COMPILER INVOKED BY: E:\Keil5C251\C251\BIN\C251.EXE ..\USER\Hardware\TrackElement.c XSMALL WARNINGLEVEL(3) OPTIMIZE(0,SP
                    -EED) BROWSE INCDIR(..\..\Libraries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_peripheral;..\C
                    -ODE;..\USER\inc;..\USER\src;..\USER\Hardware;..\USER\Hardware) DEBUG PRINT(.\Out_File\TrackElement.lst) TABS(2) OBJECT(.
                    -\Out_File\TrackElement.obj) 

stmt  level    source

    1          /*
    2           * @Description: 
    3           * @Author: Yzhi
    4           * @Date: 2024-01-10 09:24:18
    5           * @LastEditTime: 2024-01-10 09:32:32
    6           * @LastEditors: Yzhi
    7           */
    8          #include "myconfig.h"
    9          
   10          int Element_Order[4]={0};
   11          
   12          int shizi_flag=0;
   13          int ring_flag=-1;
   14          long bmq_jifen=0;
   15          double angle_jifen=0;
   16          int Track_flag=0; //正常循迹
   17          int set_speed = 0; //在赛道上不断更改速度
   18          
   19          int RING_FLAG1=0;
   20          int RING_FLAG2=0;
   21          int RING_FLAG3=0;
   22          int RING_FLAG4=0;
   23          
   24          int ANGLE_FLAG=0; //角度积分标志
   25          double Angle4=0;  //角度积分
   26          int DISTANCE_FLAG=0;//距离积分标志
   27          long Distance=0;//距离积分
   28          
   29          /*外环与电机pid与速度改变的参数*/
   30          
   31          double Sub_wh_p = 20;
   32          double Sub_wh_d = 10;
   33          double Sub_motor_p = 0;
   34          double Sub_motor_i = 0;
   35          int    Sub_speed = -10;
   36          
   37          void Distace(int flag)
   38          {
   39   1        DISTANCE_FLAG=flag;
   40   1        if(DISTANCE_FLAG)
   41   1           Distance+=(R_Pulse+L_Pulse)/2;
   42   1      }
   43          
   44          /**
   45          *  @brief      十字路口
   46          *  @param      void
   47          *  @return     void
   48          **/
   49          void Crossroad(void)
   50          {
   51   1         if(L1_NOR_ADC>40&&L2_NOR_ADC>40&&R2_NOR_ADC>40&&R1_NOR_ADC>40||shizi_flag==-1)//十字路口
   52   1         {
   53   2          shizi_flag=-1;
   54   2          Track_flag=0;
   55   2          bmq_jifen+=(R_Pulse+L_Pulse)/2;
   56   2          if(bmq_jifen>524)
C251 COMPILER V5.60.0,  TrackElement                                                       07/04/24  19:47:35  PAGE 2   

   57   2          {
   58   3            bmq_jifen=0;
   59   3            shizi_flag=1;
   60   3          }
   61   2          Motor_PWM(2000,2000);
   62   2         }
   63   1         else
   64   1           Track_flag=1;//正常循迹
   65   1      }
   66          /**
   67          *  @brief      六边环岛
   68          *  @param      角度
   69          *  @return     void       
   70          **/
   71          void Roundabout(float angle)
   72          {
   73   1         static int bmq_flag=0,angle_flag=0,angle2=0,yu_flag=0,angle_flag2=0,status=0;
   74   1         if(L1_NOR_ADC>100&&R1_NOR_ADC>55&&R2_NOR_ADC<15&&L2_NOR_ADC<15||ring_flag==0||ring_flag==1)//六边环岛
   75   1         {
   76   2           if(status==0)  //预进入环岛
   77   2            if(bmq_jifen<4524&&bmq_flag==0)
   78   2            {
   79   3              bmq_jifen+=(R_Pulse+L_Pulse)/2;
   80   3              Motor_PWM(2000,2000);
   81   3              ring_flag=0;
   82   3              Track_flag=0;
   83   3            }
   84   2            else
   85   2            {
   86   3              status=1; 
   87   3              bmq_jifen=0;
   88   3              bmq_flag=1; //编码器停止积分
   89   3              angle_flag2=2;//进入环岛打固定角度
   90   3            }
   91   2          else if(status==1)//进入环岛
   92   2          { 
   93   3            if(angle_flag2==2&&angle_flag==0)//转40度
   94   3            {
   95   4              if(Angle_Ring(45,angle1,70,0.4,40))
   96   4              {
   97   5                angle1=0;  //角度积分清零
   98   5                yu_flag=3;//编码器开启积分
   99   5                angle_flag2=0;//退出角度积分
  100   5                angle_flag=1;//停止陀螺仪积分
  101   5              }
  102   4              else
  103   4                  angle1+=(Get_Angle()/7387)+0.0001;
  104   4            }
  105   3            if(yu_flag==3) //进入圆环行驶一段距离开始正常循迹
  106   3            {
  107   4              if(bmq_jifen<1024&&yu_flag==3)
  108   4              {
  109   5                bmq_jifen+=(R_Pulse+L_Pulse)/2;
  110   5                Motor_PWM(2000,2000);
  111   5              }
  112   4              else
  113   4              {
  114   5                bmq_jifen=0;
  115   5                yu_flag=0; //编码器停止积分
  116   5                ring_flag=4;//进入圆环结束
  117   5                status=3;
  118   5                Track_flag=1;//正常循迹
  119   5              }     
  120   4            }
  121   3          }
  122   2          else if(status==3) //出环岛
C251 COMPILER V5.60.0,  TrackElement                                                       07/04/24  19:47:35  PAGE 3   

  123   2          {
  124   3            if(R1_NOR_ADC>30&&L1_NOR_ADC>30&&R2_NOR_ADC<10&&L2_NOR_ADC>15||status==3)//出六边环岛
  125   3            {
  126   4              if(bmq_jifen<1524&&status==3)
  127   4              {
  128   5                bmq_jifen+=(R_Pulse+L_Pulse)/2;
  129   5                Motor_PWM(1800,2300);
  130   5              }
  131   4              else
  132   4              {
  133   5                bmq_jifen=0;
  134   5                status=4;
  135   5                Track_flag=1;//正常循迹
  136   5              }   
  137   4            }
  138   3          }
  139   2          else
  140   2             Track_flag=1;
  141   2         }
  142   1         else 
  143   1           Track_flag=1;
  144   1      }
*** WARNING C47 IN LINE 71 OF ..\USER\Hardware\TrackElement.c: 'angle': unreferenced parameter
  145          
  146          void Sub_Pid(float error)
  147          {
  148   1          float err = error;
  149   1        if(err>20) //偏离赛道最大
  150   1        {
  151   2          Sub_wh_p = 20;
  152   2          Sub_wh_d = 10;
  153   2          Sub_motor_p = 0;
  154   2          Sub_motor_i = 0;
  155   2          Sub_speed = -10;
  156   2        }
  157   1      }
  158          
  159          /**
  160          *  @brief      基础循迹
  161          *  @param      void
  162          *  @return     void        
  163          **/
  164          void Tracking(int Set_speed)
  165          {
  166   1        static int count=0,pwm=0;
  167   1        Sum_Pulse=(L_Pulse+R_Pulse)/2;
  168   1        count++;
  169   1        dir_out=DirControl();
  170   1        if(count==10)
  171   1        {
  172   2          pwm=Speed_pid_Out(Set_speed,Sum_Pulse); //减或加一个方向环的输出
  173   2          count=0;
  174   2        }
  175   1        Motor_PWM(pwm-dir_out,pwm+dir_out);
  176   1      }
  177          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =      1051     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
C251 COMPILER V5.60.0,  TrackElement                                                       07/04/24  19:47:35  PAGE 4   

  edata size           =        90     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =       190     ------
End of Module Information.


C251 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
